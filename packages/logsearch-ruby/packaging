#!/bin/bash

exec 2>&1

set -e
set -u

CPUS=$(grep -c ^processor /proc/cpuinfo)


tar -xzf source/yaml-0.1.6.tar.gz
tar -xzf source/ruby-1.9.3-p545.tar.gz


( cd yaml-0.1.6

  ./configure \
    --prefix=${BOSH_INSTALL_TARGET}

  make -j${CPUS}
  make install

)


( cd ruby-1.9.3-p545

  sed -i 's/\(OSSL_SSL_METHOD_ENTRY(SSLv2[^3]\)/\/\/\1/g' ext/openssl/ossl_ssl.c

  ./configure \
    --prefix=${BOSH_INSTALL_TARGET} \
    --disable-install-doc

  make -j${CPUS}
  make install

)
